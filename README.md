# Learning with Confidence: Training Better Classifiers from Soft Labels

This repository contains the code for the Soft Label Learning (SLL) package.

The results accompanying this code are presented in the paper: "Learning with Confidence: Training Better Classifiers from Soft Labels" by Sjoerd de Vries and Dirk Thierens.

## Installation

The virtual environment that was used to run this framework is specified in the requirements.txt, and mainly relies on the SYNLABEL package (https://github.com/sjoerd-de-vries/SYNLABEL) and its dependencies.

The code was tested using Python version 3.10.

To create a new virtual environment, use:

`$ python -m venv .venv`

Then activate the environment using:

`$ source .venv/bin/activate`

Then install the needed packages using:

`$ pip install -r requirements.txt`

The SLL package will automatically be installed as a locally editable package, along with some additional packages required to run the experiments.

## Setting the paths

The paths to the data and the repository need to be set in the file ***/src/soft_label_learning/config.py**. The format of this file is provided in ***/src/soft_label_learning/config_format.py**.

## Repository Structure

### **/analyses**

Contains notebooks that are used to analyse the experimental data to produce the results presented in the paper.

### **/data**

Contains the datasets that are used in the experiments.

In the folder ***/uci_keel** the datasets that are used in the synthetic data experiments are saved.

In the folder ***/real_world** the datasets that are used in the real-world experiment can be saved.

### **/experiments**

Contains python files used to run the experiments from the paper.

In the folder ***/feature_hiding_mtvd** the intermediate results that are used for constructing low and high uncertainty ground truth datasets are saved.

In the folder ***/logs** some logs are saved.

In the folder ***/processed_G_PG_sets** the datasets that are generated by the synthetic data experiments are saved.

In the folder ***/synthetic_data_results** the results of the synthetic data experiments are saved.

### **/output**

Folder in which the figures produced by the files in ***/analyses** are stored.

### **/src/soft_label_learning**

The package that contains the supporting code used for running and analysing the experiments. 

***/data_generation**

Contains the files that are used for processing the datasets.

***/experiments**

Contains the files that are used for running the experiments.

***/methods**

Contains the code that implements the different methods that are used in the experiments.

**config.py**

Contains the absolute paths to the data and repository.

## How to use

### Methods

If you want to use the methods in the SLL package for comparison or future research, you will only need to use the code located in the ***/src/soft_label_learning/methods** folder.

The remainder of the code in the repository is used to run the experiments and analyse the results and is mainly of interest for replicating the results presented in the paper.

### Experiments

The experiment parameters are set in the  ***src/soft_label_learning/experiments/experiment_settings.py** file.

### Gaussian experiment

The code for the Gaussian experiment is contained in ***/experiments/run_gaussian_experiment.py**.

The results of the experiments are saved in the folder ***/output/gaussians/**.

The experimental data are analysed in the notebook ***/analyses/gaussian_analysis.ipynb**.

The resulting figures are saved in the folder ***/output/gaussians/**.



### Synthetic data experiments

#### Miscalibration

The code for generating the figure depicting the four miscalibration noise models is contained in ***/analyses/calibration_noise_models.py**.

#### Synthetic data preparation

In order to determine the cutoffs for the low and high uncertainty levels in the synthetic data experiments, the mean Total Variation Distance (MTVD) is calculated for each dataset, for different numbers of features hidden by running the files ***/experiments/run_mtvd_per_set_lr.py** and ***/experiments/run_mtvd_per_set_rf.py**. The results are saved in the folder ***/experiments/feature_hiding_mtvd/**.

To determine the cutoffs based on these MTVD values, the notebook ***/experiments/synthetic_data_preparation.ipynb** is used.

The results are saved in the folder ***/experiments/feature_hiding_mtvd/**.

#### Q1

The code for the Q1 experiment is contained in ***/experiments/run_synthetic_q1_experiment.py**.

The results of the experiment are saved in the folder ***/experiments/synthetic_data_results/[timestamp]**.

The experimental data are analysed in the notebook ***/analyses/synthetic_q1_analysis.ipynb**.

The resulting figures are saved in the folder ***/output/Q1/**.

#### Q2

The code for the Q2 experiment is contained in ***/experiments/run_synthetic_q2_experiment.py**.

The results of the experiments are saved in the folder ***/experiments/synthetic_data_results/[timestamp]**.

These results can be further processed using the file ***/experiments/q2_intermediate_processing.py**, saving the results in the ***/experiments/synthetic_data_results/** folder.

The experimental data are analysed in the notebook ***/analyses/synthetic_q2_analysis.ipynb**.

The resulting figures are saved in the folder ***/output/Q2/**.

### Real-World experiment


The code for the real-world data experiment using the UrinCheck dataset is contained in ***/experiments/run_real_world_experiment.py**.

Note that the UrinCheck dataset is not included in this repository, as it contains medical data. Instead, the experiment can be repeated using another real-world dataset.

The results of the experiments are saved in the folder ***/output/real_world/**.

The experimental data are analysed in the notebook ***/analyses/real_world_analysis.ipynb**.

The resulting figures are saved in the folder ***/output/real_world/**.
